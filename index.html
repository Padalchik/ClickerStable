<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity Web Player | TestClickerTelegram</title>

	<style>
	#unity-loading-bar {
		position: absolute;
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
		width: 50%;
		background: rgba(0, 0, 0, 0.5);
		padding: 10px;
		border-radius: 10px;
		text-align: center;
		display: none;
	}

	#unity-progress-bar-empty {
		width: 100%;
		height: 10px;
		background: rgba(255, 255, 255, 0.3);
		border-radius: 5px;
		overflow: hidden;
	}

	#unity-progress-bar-full {
		width: 0%;
		height: 100%;
		background: #4caf50;
		transition: width 0.3s ease;
	}
	</style>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Telegram API -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var buildUrl = window.location.pathname.replace(/\/$/, "") + "/Build";
            var loaderUrl = buildUrl + "/Build.loader.js";
            var config = {
                dataUrl: buildUrl + "/Build.data",
                frameworkUrl: buildUrl + "/Build.framework.js",
                codeUrl: buildUrl + "/Build.wasm",
                streamingAssetsUrl: "StreamingAssets",
                companyName: "DefaultCompany",
                productName: "TestClickerTelegram",
                productVersion: "1.0",
            };

            var script = document.createElement("script");
            script.src = loaderUrl;
            script.onload = () => {
                if (typeof createUnityInstance !== "undefined") {
                    let loadingBar = document.querySelector("#unity-loading-bar");
                    if (loadingBar) {
                        loadingBar.style.display = "block"; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π
                    }

                    createUnityInstance(document.querySelector("#unity-canvas"), config, (progress) => {
                        let progressBar = document.querySelector("#unity-progress-bar-full");
                        if (progressBar) {
                            progressBar.style.width = `${100 * progress}%`;
                        } else {
                            console.warn("‚ö†Ô∏è –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω!");
                        }
                    }).then((instance) => {
                        window.unityInstance = instance;
                        console.log("‚úÖ Unity –∑–∞–≥—Ä—É–∂–µ–Ω!");

                        // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
                        if (loadingBar) {
                            loadingBar.style.display = "none";
                        }
                    }).catch((err) => {
                        console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Unity:", err);
                    });
                } else {
                    console.error("‚ùå createUnityInstance –Ω–µ –Ω–∞–π–¥–µ–Ω!");
                }
            };
            script.onerror = (err) => {
                console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ `Build.loader.js`:", err);
            };

            document.body.appendChild(script);
        });

        function RequestTelegramUserID() {
            if (!window.Telegram || !window.Telegram.WebApp) {
                console.error("‚ùå Telegram API –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω!");
                return;
            }

            let tg = window.Telegram.WebApp;
            tg.expand();
            let userID = tg.initDataUnsafe?.user?.id || 0;

            console.log("üì° –ü–æ–ª—É—á–µ–Ω userID –∏–∑ Telegram:", userID);

            if (!userID || userID === 0) {
                console.warn("‚ö†Ô∏è userID –Ω–µ –ø–æ–ª—É—á–µ–Ω, –≤–æ–∑–º–æ–∂–Ω–æ, Telegram WebApp –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç –¥–∞–Ω–Ω—ã–µ.");
            }

            function sendToUnity() {
                if (window.unityInstance) {
                    console.log("üì° –û—Ç–ø—Ä–∞–≤–ª—è–µ–º userID –≤ Unity:", userID);
                    window.unityInstance.SendMessage("ClickerManager", "SetUserIDFromJS", userID.toString());
                } else {
                    console.log("‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ Unity...");
                    setTimeout(sendToUnity, 1000);
                }
            }

            setTimeout(sendToUnity, 500);
        }
    </script>
</head>
<body>
    <div id="unity-container">
        <canvas id="unity-canvas" style="width: 100vw; height: 100vh;"></canvas>
        <div id="unity-loading-bar">
            <div id="unity-logo"></div>
            <div id="unity-progress-bar-empty">
                <div id="unity-progress-bar-full"></div>
            </div>
        </div>
    </div>
</body>
</html>
